<!DOCTYPE html>
<html lang="de">
<head>
    <title>Biboquiz RoRo</title>
    <meta name="author" content="&Eacute;mile Jeremias Ruff">
    <link rel="icon" type="image/png" href="favicon.ico">

    <link rel="stylesheet" href="quiz-style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="quiz">
    <section class="screen active" id="start-screen">
        <h1>Willkommen zum Quiz!</h1>
        <form id="startForm">
            <input type="text" id="username" placeholder="Dein Name" autofocus>
            <button type="submit">Start</button>
        </form>
    </section>

    <section class="screen" id="screen"></section>

    <section class="screen" id="end-screen">
      <h2>Fertig üéâ</h2>
      <p id="endText"></p>

      <h3>üèÜ Bestenliste</h3>
      <ul id="scoreboard"></ul>

      <button id="restart">Quiz wiederholen</button>
    </section>
</div>

<div>
    <img src="b/quiz-arrow.png" alt="Pfeil">
    <p><a href="../" alt="Zum Online-katalog">Zum Online-Katalog</a></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    
const SUPABASE_URL = "https://euuptkidjsquvhohvicv.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1dXB0a2lkanNxdXZob2h2aWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMDk4OTksImV4cCI6MjA3MDU4NTg5OX0.O1isV0Ove_Tb1ruXqY_dlD4UdQGM174eVw9Kp_22YO4";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const quizData = [
  {
    question: "Was sch√§tzt du, wie viele B√ºcher, CDs usw. unsere Bibliothek zur Verf√ºgung stellt?",
    type: "single",
    answers: ["300 bis 400","400 bis 4.000","15.000 bis 16.000","√ºber 17.000"],
    correct: 2,
    explanation: "Unser Angebot erstreckt sich √ºber insgesamt 15866 Medien - ohne Schulb√ºcher. (Stand 09.01.2026)"
  },
  {
    question: "W√§hle die richtigen Regeln aus:",
    type: "multi",
    answers: [
      "B√ºcher sind sorgf√§ltig zu behandeln.",
      "Ist es besonders kalt, so d√ºrfen sie verbrannt werden.",
      "Zum Lesen sollte immer ein Getr√§nk und Geb√§ck bereitstehen.",
      "Ruhe ist zu bewahren."
    ],
    correct: [0,3],
    explanation: "Ruhe und Sorgfalt - entgegen dem Verzehr von Lebensmitteln."
  },
  {
    question: "Welches Buch ist das meistausgeliehene? Haben wir auch Kochb√ºcher?",
    type: "multi",
    answers: [
      "Kinney, Jeff: Gregs Tagebuch",
      "Brandis, Katja: Woodwalkers",
      "Ende, Michael: Jim Knopf und Lukas der Lokomotivf√ºhrer",
      "Ja, selbst Kochb√ºcher stehen zur Verf√ºgung.",
      "Nein, Kochb√ºcher gibt es nicht."
    ],
    correct: [0,3],
    explanation: "Auf Wunsch der Lernenden, Lehrenden und Co. k√∂nnen ebenfalls B√ºcher angeschafft werden, die in keiner direkten Verbindung zum Unterricht stehen - ebenfalls Gregs Tage- und Kochb√ºcher"
  },
  {
    question: "Arbeiten auch F√ºnftkl√§ssler in unserer Bibo?",
    type: "single",
    answers: ["Ja","Nein"],
    correct: 0,
    explanation: "Ab Klasse 5 √ºber das Ganztagsangebot ‚ÄöBibo-AG‚Äò."
  },
  {
    question: "Wie ordnen wir unsere Jugendb√ºcher?",
    type: "single",
    answers: [
      "Alphabetisch nach Titel",
      "Alphabetisch nach Nachname des Autors",
      "Nach Erscheinungsjahr",
      "Nach L√§nge"
    ],
    correct: 1,
    explanation: "Jugendb√ºcher und Belletristik nach Autorennamen, Sach- und Fachb√ºcher nach Signatur"
  },
  {
    question: "Welche Personen k√∂nnen in unserer Bibliothek mithelfen?",
    type: "multi",
    answers: ["Kurator/in","Bibliothekar/in","Archivar/in","Sch√ºler/in"],
    correct: [1,3],
    explanation: "Neben Bibliothekarinnen und der Bibo-AG helfen uns auch Lehrende gegen ein kleines Entgelt."
  },
  {
    question: "Kann das Bibo-Personal sehen, was an den Computern passiert?",
    type: "single",
    answers: ["Ja","Nein"],
    correct: 0,
    explanation: "Es ist sogar m√∂glich, die PCs fernzusteuern (;"
  }
];

function randomGermanUsername() {
  const adjectives = [
    "Lesender", "Neugieriger", "Schlauer", "Flinker", "Stiller",
    "Kreativer", "Flei√üiger", "Lustiger", "Mutiger", "Geheimer"
  ];

  const nouns = [
    "B√ºcherwurm", "Bibliotheksgeist", "Lesefuchs", "Seitenbl√§tterer",
    "Romanheld", "Wissensj√§ger", "BiboFan", "Papierdrache"
  ];

  const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
  const noun = nouns[Math.floor(Math.random() * nouns.length)];
  const number = Math.floor(Math.random() * 100);

  return `${adj}${noun}${number}`;
}

const startScreen = document.getElementById("start-screen");
const quizScreen  = document.getElementById("screen");
const endScreen   = document.getElementById("end-screen");
const endText     = document.getElementById("endText");
const scoreboard  = document.getElementById("scoreboard");
const restartBtn  = document.getElementById("restart");

let index = 0;
let score = 0;
let username = "";

function shuffle(array) {
  return array
    .map(v => ({ v, sort: Math.random() }))
    .sort((a, b) => a.sort - b.sort)
    .map(({ v }) => v);
}

document.getElementById("startForm").addEventListener("submit", e => {
  e.preventDefault();
  username = document.getElementById("username").value.trim() || "Gast";

  startScreen.classList.remove("active");
  quizScreen.classList.add("active");

  index = 0;
  score = 0;
  renderQuestion();
});

function renderQuestion() {
  const q = quizData[index];
  const type = q.type === "multi" ? "checkbox" : "radio";

  const shuffledAnswers = shuffle(
    q.answers.map((text, originalIndex) => ({
      text,
      originalIndex
    }))
  );

  quizScreen.innerHTML = `
    <h2>${q.question}</h2>
    ${shuffledAnswers.map(a => `
      <label class="option">
        <input type="${type}" name="answer" value="${a.originalIndex}">
        <span class="circle"></span>${a.text}
      </label>
    `).join("")}
    <button id="check" disabled>Pr√ºfen</button>
    <div class="feedback" id="feedback"></div>
  `;

  const inputs = quizScreen.querySelectorAll("input");
  const check  = quizScreen.querySelector("#check");
  const fb     = quizScreen.querySelector("#feedback");

  inputs.forEach(i => i.addEventListener("change", () => {
    check.disabled = [...inputs].every(x => !x.checked);
  }));

  check.addEventListener("click", () => {
    score += countCorrect();

    const correct = isCorrect();
    fb.textContent = correct ? "Richtig!" : "Falsch!";
    fb.className = "feedback " + (correct ? "correct" : "wrong");
    if(q.explanation) fb.textContent += " " + q.explanation;

    check.remove();
    const next = document.createElement("button");
    next.textContent = index === quizData.length - 1 ? "Auswertung" : "Weiter";
    next.onclick = nextScreen;
    quizScreen.appendChild(next);
  });
}

function isCorrect() {
  const q = quizData[index];
  const checked = [...quizScreen.querySelectorAll("input:checked")].map(i=>+i.value);
  if(q.type === "single") return checked[0] === q.correct;
  return checked.length === q.correct.length && checked.every(v=>q.correct.includes(v));
}

function countCorrect() {
  const q = quizData[index];
  const checked = [...quizScreen.querySelectorAll("input:checked")].map(i=>+i.value);
  if(q.type === "single") return checked[0] === q.correct ? 1 : 0;
  return checked.filter(v=>q.correct.includes(v)).length;
}

async function nextScreen() {
  quizScreen.classList.add("exit-left");

  setTimeout(async () => {
    index++;

    if(index >= quizData.length) {
      quizScreen.classList.remove("active", "exit-left");
      quizScreen.innerHTML = "";

      await saveScore();
      await loadScoreboard();

      endText.textContent = `${username}, dein Score: ${score}`;
      endScreen.classList.add("active");
    } else {
      quizScreen.classList.remove("exit-left");
      renderQuestion();
    }
  }, 400);
}

async function saveScore() {
  if (username === "Gast") return;

  await client.from("quiz-scores").insert({
    name: username,
    score: score
  });
}

async function loadScoreboard() {
  const { data, error } = await client
    .from("quiz-scores")
    .select("name, score")
    .order("score", { ascending: false })
    .limit(5);

  if (error || !data) {
    scoreboard.innerHTML = "<li>Keine Daten verf√ºgbar</li>";
    return;
  }

  scoreboard.innerHTML = data.map(e => `
    <li>${e.score} - ${e.name}</li>
  `).join("");
}

const usernameInput = document.getElementById("username");
usernameInput.placeholder = "Dein Name (oder " + randomGermanUsername() + ")";

restartBtn.addEventListener("click", () => {
  index = 0;
  score = 0;
  username = "";

  endScreen.classList.remove("active");
  startScreen.classList.add("active");
  document.getElementById("username").value = "";
});

});
</script>

</body>
</html>
